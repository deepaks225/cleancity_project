<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Cleaning Drives</title>
    <link rel="stylesheet" href="/navbar.css">
    <link rel="stylesheet" href="/user.css">
    <link rel="stylesheet" href="/hamburger.css">
</head>
<body>
    <header>
        <h1>Cleaning Drives</h1>

        <!-- Hamburger menu -->
        <div class="hamburger" >
            <span></span>
            <span></span>
            <span></span>
        </div>

        <% if (locals.user) { %>
            <nav id="main-nav">
                <a href="/home">Home</a>
                <a href="/capture">Report Litter</a>
                <a href="/profile">Profile</a>
                <a href="/notifications">Notifications</a>
                <a href="/drives">Cleaning Drives</a>
                <a href="/logout">LogOut</a>
            </nav>
        <% } else { %>
            <nav id="main-nav">
                <a href="/">Home</a>
                <a href="/signin">SignIn</a>
                <a href="/signup">SignUp</a>
            </nav>
        <% } %>
    </header>

    <main>
        <section id="drives-section">
            <h2>My Cleaning Drives</h2>
            <div class="drives-container">
                <% if (drives && drives.length > 0) { %>
                    <% drives.forEach(drive => { %>
                        <div class="drive-card">
                            <h3><%= drive.location %></h3>
                            <p>Date: <%= new Date(drive.date).toLocaleDateString() %></p>
                            <p>Participants Required: <%= drive.number %></p>
                            <p>Applied Participants: <%= drive.Applied %></p>
                            <% const hasApplied = drive.appliedUsers.includes(user._id); %>
                            <% const isFull = drive.Applied >= drive.number; %>
                            <% if (hasApplied) { %>
                                <p class="applied-status">Already Applied</p>
                            <% } else if (isFull) { %>
                                <p class="full-status">Drive Full</p>
                            <% } else { %>
                                <form action="/apply" method="post">
                                    <input type="hidden" name="driveId" value="<%= drive._id %>">
                                    <button type="submit">Apply</button>
                                </form>
                            <% } %>
                        </div>
                    <% }) %>
                <% } else { %>
                    <p>No cleaning drives found.</p>
                <% } %>
            </div>
        </section>
    </main>

    <script>
        const hamburger = document.querySelector('.hamburger');
        const nav = document.getElementById('main-nav');

        hamburger.addEventListener('click', () => {
            hamburger.classList.toggle('active');
            nav.classList.toggle('active');
        });
    </script>
</body>
</html>
